---
title: 模式扩展
date: 2020-12-12 11:49:16
permalink: /pages/0796ba76b4b55362
categories:
  - 《Bash脚本教程》笔记
tags:
  - Bash
author:
  name: fubowen
  link: https://github.com/Flbven
---

# 模式扩展

## 简介

Shell在接收到用户输入的命令以后，会根据空格将用户的输入拆分成一个个词元，然后会对词元中的特殊字符进行扩展，之后才进行命令调用。这种特殊字符的扩展，被称为`模式扩展（globbing）`。Bash一共提供八种扩展。

- 波浪线扩展
- `?` 字符扩展
- `*` 字符扩展
- 方括号扩展
- 大括号扩展
- 变量扩展
- 子命令扩展
- 算术扩展

值得注意的是，模式扩展是`Bash`进行的，而不是命令本身，命令本身只负责处理收到的参数。

另外模式扩展与正则表达式并不相同，它没有正则表达式那么强大灵活，但是简单方便。

可以通过命令来关闭扩展：

```bash
$ set -o noglob
# 或
$ set -f
```

开启扩展只需要将上面的命令的`-`改为`+`。



## 模式扩展

### 波浪线扩展

`~`会自动扩展成当前用户的主目录，`~/dir`会扩展为主目录的某个子目录：

```bash
$ echo ~
$ cd ~/dir
```

而`~user`表示扩展为用户`user`的主目录：

```bash
$ echo ~root
/root
```

如果user不存在的话，扩展将不起作用。

`~+`会扩展为当前所在目录，等同于`pwd`命令。

### `?`字符扩展

`?`字符代表文件路径里面的任意`单个`字符，==不包括空字符==：

```bash
$ echo ?.txt
a.txt b.txt
```

如果要匹配两个任意字符，可以使用`??`：

```bash
$ echo ??.txt
ab.txt
```

同样，`?`字符扩展只有在目标文件确实存在的情况下才会发生扩展。

### `*`字符扩展

`*`字符代表文件路径里面的任意数量的任意字符，==包含空字符==：

```bash
$ ls *.txt
a.txt b.txt ab.txt

$ ls a*.txt
a.txt ab.txt
```

但是默认情况下`*`不会匹配隐藏文件，如果要匹配隐藏文件需要写成`.*`。

如果要排除`.`和`..`两个特殊的隐藏文件，可以与方括号扩展结合：

```bash
$ echo .[!.]*
```

上面的式子代表`*`不匹配`.`。

同时`*`只会匹配当前目录，如果要匹配子目录，可以写成`*/*.txt`。有几层子目录，就要写几层`*`。

同样，`*`字符扩展只有在目标文件确实存在的情况下才会发生扩展。

Bash 4.0 引入了一个参数`globstar`，当该参数打开时，允许`**`匹配零个或多个子目录。因此，`**/*.txt`可以匹配顶层的文本文件和任意深度子目录的文本文件。

### 方括号扩展

方括号扩展的形式是`[...]`，意为匹配[]内任意一个字符，如`[abc]`可以匹配a或b或c。

还有两种变体：`[^...]`和`[!...]`。它们都表示匹配不在[]内的字符。

同样，方括号扩展只有在目标文件确实存在的情况下才会发生扩展。

方括号扩展的简写形式，表示匹配一个连续的范围，如：

```bash
$ ls [a-b].txt
a.txt
b.txt

$ ls report[0-2].txt
report1.txt
report2.txt
```

[]内可以放入多个区间，比如`[a-bf-gk-z]`。

同样`^`和`!`也可以用来表示否定。

### 大括号扩展

大括号扩展`{...}`表示分别扩展为大括号里面的所有值，各个值之间使用逗号分隔，但是**逗号前后不能有空格**：

```bash
$ echo {1,2,3}
1 2 3

$ echo d{a,e}g
dag deg

$echo {1, 2} # 扩展失效
{1, 2}
```

与上面的几种扩展不同，大括号扩展**不是文件名扩展**，因此无论是否有对应的文件都会进行扩展。

大括号的用法很灵活：

```bash
$ ls a.log{,.back} # 第一项为空
a.log a.log.back

$ echo {j{p,pe}g,png} # 嵌套使用
jpg jpeg png

# 与其他模式连用，此时大括号扩展优先级最高
$ echo /bin/{cat,b*}
```

大括号扩展也支持连续序列，同时支持逆序：

```bash
$ echo {c..a}
c b a
```

如果遇到无法理解的简写，大括号会原样输出：

```bash
$ echo {a1..3c}
{a1..3c}
```

如果整数前面有前导0，扩展输出的每一项都有前导0：

```bash
$ echo {01..5}
01 02 03 04 05
```

这种形式还可以改为`{start..end..step}`来设置步长：

```bash
$ echo {0..8..2}
0 2 4 6 8
```

多个简写形式连用，达到循环的效果：

```bash
$ echo {a..b}{1..3}
a1 a2 a3 b1 b2 b3
```

### 变量扩展

Bash将`$`开头的视为变量，并将其扩展:

```bash
$ echo $SHELL
/bin/bash
# 或
$ echo ${SHELL}
/bin/bash
```

### 子命令扩展

`$(...)`可以扩展为另一个命令的运行结果。

```bash
$ echo $(date)
Sat Dec 4 15:24:47 CST 2021
```

### 算术扩展

`$((...))`可以扩展为整数运算的结果：

```bash
$ echo $((2*2))
4
```

### 字符类

`[[:class:]]`表示一个字符类，扩展成某一类特定字符之中的一个。常用的字符类如下。

- `[[:alnum:]]`：匹配任意英文字母与数字
- `[[:alpha:]]`：匹配任意英文字母
- `[[:blank:]]`：空格和 Tab 键。
- `[[:cntrl:]]`：ASCII 码 0-31 的不可打印字符。
- `[[:digit:]]`：匹配任意数字 0-9。
- `[[:graph:]]`：A-Z、a-z、0-9 和标点符号。
- `[[:lower:]]`：匹配任意小写字母 a-z。
- `[[:print:]]`：ASCII 码 32-127 的可打印字符。
- `[[:punct:]]`：标点符号（除了 A-Z、a-z、0-9 的可打印字符）。
- `[[:space:]]`：空格、Tab、LF（10）、VT（11）、FF（12）、CR（13）。
- `[[:upper:]]`：匹配任意大写字母 A-Z。
- `[[:xdigit:]]`：16进制字符（A-F、a-f、0-9）。

在第一个方括号后加上`!`表示否定：

```bash
$ echo [![:digit:]]*
```

字符类也属于文件名扩展，如果没有匹配就会原样输出。