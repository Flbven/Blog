---
title: Https加密
date: 2021-12-16 11:01:44
permalink: /pages/e968fc/
categories:
  - 计算机网络
tags:
  - 计算机网络
  - 加密
---

# HTTPS加密

## HTTPS协议的出现

HTTPS为什么是神，在谈论这个问题之前我想先聊聊其他网络传输协议相较于HTTPS差在哪里，首先是犯下不安全之罪的HTTP。（误）

在没有HTTPS之前，最广泛使用的网络传输协议是HTTP协议，它使用的是明文传输，随着网络信息传输的数量和种类越来越多，人们对安全性的要求也越来越高，然后HTTPS应运而生，可以简单理解为HTTPS = HTTP + SSL/TLS, 通过对数据进行加密保证数据的安全，但是HTTPS并不是简单的对数据进行加密，而是结合了最常用的对称加密和非对称加密。

## 对称加密与非对称加密

### 对称加密

对称加密是一种简单的加密方式，通信双方持有完全相同的公钥，通过公钥可以将加密的数据解密，将未加密的数据加密。但是由于此公钥是公开的，如果有人截取了客户端发出去的信息，也完全可以进行解密获取数据，也就是**中间人攻击**，所以普通的对称加密并不是绝对安全的。

### 非对称加密

非对称加密使用了公私钥，也就是通过公钥加密的数据只能通过私钥解密，通过私钥加密的数据只能通过公钥解密。

模拟普通的C/S通信过程：
① Client首先获取Server的公钥
② Client将经过公钥加密的数据上传到Server，Server使用私钥解密得到数据
客户端发出去的数据可以说是安全了，但是这样做有一个问题就是如果有人截取了服务器传回来的数据，也是能够通过公钥解密的，所以非对称加密也不是绝对安全的。

## 加密技术的改进

### 非对称加密+对称加密

两种加密方式都有自己的缺陷，后来出现了将二者结合起来使用的通信方法。

模拟普通的C/S通信过程：
① Client首先获取Server的公钥
② Client向Server发送一个key值，通过公钥加密，Server使用私钥解密得到key
③ 双方使用约定的key进行对称加密通信
但是仍然有攻破的方法，第三方如果能够劫取客户端获取公钥的报文，那就可以模拟客户端与服务器进行通信，而返还给客户端自己的公钥，之后②的时候它可以获取客户端的key值，也达到了**中间人攻击**的效果。

### HTTPS加密

由于我们无法确认请求到的公钥是否来自目标服务器，现在多了一个CA(Certificate Authority),负责颁发数字证书以证明服务器身份。

CA本身持有一个公钥和私钥，当服务器在CA申请数字证书后，CA用自己的私钥将服务器的公钥包括其他信息如服务器地址、CA本身的信息进行加密，就构成了license，当客户端请求公钥时，服务器并不直接发送自己的公钥，而是发送自己的license。

客户端想要得到服务器的公钥就需要解密得到的license，收到后浏览器会检查操作系统中是否已经安装过该CA的证书，如果有就选择信任这个license；如果没有就会递归检查该CA的上级CA机构，看看有没有他们的证书，直到检查到根证书，根证书就是说这个机构没有其他机构为他签名，一般是非常有信誉的机构才能当选。层层的证明构成了一条信用链，保障了信息的可信度。

当确认得到的公钥正确后，客户端和服务器就会交换信息，商量一个key值进行对称加密，因为非对称加密是非常消耗资源的，整个的确立过程是与请求公钥在一起的，整个通信前置过程如下：
① Client发起请求，同时告知Server自己支持的SSL/TLS版本，携带一个随机数random1
② Server收到请求，同时确定使用的SSL/TLS版本和对称加密算法(设为f)，携带自己的证书和一个随机数random2
③ Client验证证书，验证通过后发送f(random1, random2)的值f1以及一个随机数random3
④ Server 验证收到的f1=f(random1, random2)以确定是Client发送的消息,之后使用算法g(random1, random2, random3)得到一个key，发送f(random1, random2, random3)的值f2给Client
⑤ Server 验证收到的f2=f(random1, random2, random3)以确定是Server发送的消息,同样使用算法g(random1, random2, random3)得到一个key

之后通信双方使用key来通信。